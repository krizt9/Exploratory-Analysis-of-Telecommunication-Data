---
title: Završni rad - Eksploratorna analiza telekomunikacijskih
  podataka u svrhu detekcije anomalija
output:
  html_document: default
  pdf_document: default
  word_document: default
---

```{r setup, include=FALSE}
library(tidyverse)
library(lubridate)
#library(plyr)
#detach("package:plyr", unload=TRUE) 
library(dplyr)
library("gridExtra")
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(results = 'hold')
rm(list = ls())
options(tibble.print_max = 6, tibble.width = Inf)
set.seed(123)
options(scipen = 999)
```

# Početna stranica
..

# Zahvala
..

# Uvod

* Što je eksploratorna analiza podataka?
* Koje podatke analiziram?
* Koji je cilj ovog rada?
* Čiji su podaci?
* Iz čije perspektive?
* Kako sam strukturirao dokument (analiza kao općenito kopanje po podacima i na kraju zaključak svih zaključaka kao svo znanje koje sam iskopao)


* Radi se o *fiksnim pozivima u prvom mjesecu* teleoperatera "VAS" načelno hrvatskih brojeva, a njihove podatke mi je ustupila tvrtka Multicom.

# Analiza

* Što je cilj ovog poglavlja
* Ovdje još ne znam ništa o podacima
* Pokušavam dobit početne poglede i vidjet ima li nekih načelnih logičkih pogrešaka u podacima
* Pokušavam uočiti bitne varijable i kako ih dovesti u zanimljive konkretne relacije
* Kako sam strukturirao analizu ( koja je svrha opažanja i zaključaka, fokus na grafovima i konkretnim zaključcima, manje na tekstu i programskom kodu)

## Učitavanje i prilagodba podataka

Najprije moram učitati podatke iz *CSV* datoteke u računalnu strukturu data frame (*hrv.* okvir podataka) kako bih njima mogao raspolagati.
Učitani podaci nisu odgovarajućeg tipa pa se pojedini stupci moraju pretvoriti iz tekstovnog u numerički tip.

* Problemi s praznom kolonom.
* Problemi s praznim izvorisnim operaterom.

```{r}
#Učitavanje podataka
teldata <- read.csv2("1mj_1M_1MilUTF.dsv", encoding = "UTF-8" , stringsAsFactors = F, header=TRUE)
teldata <- tbl_df(teldata)
```

```{r include = TRUE}
# Pretvaram u odgovarajuci tip
teldata <- mutate(teldata, TRANS_DATE = dmy_hms(TRANS_DATE))
teldata <- mutate(teldata, AMOUNT = as.double(AMOUNT))
teldata <- mutate(teldata, COMPUTED_PRICE_PER_MINUTE = as.double(COMPUTED_PRICE_PER_MINUTE))
teldata <- mutate(teldata, COMPUTED_OFF_PEAK_PRICE_PER_M = as.double(COMPUTED_OFF_PEAK_PRICE_PER_M))
teldata <- mutate(teldata, COMPUTED_ON_PEAK_PRICE_PER_M = as.double(COMPUTED_ON_PEAK_PRICE_PER_M))
teldata <- mutate(teldata, COMPUTED_ESTABLISHMENT_FEE = as.double(COMPUTED_ESTABLISHMENT_FEE))
teldata <- mutate(teldata, COMPUTED_ROUNDED_DURATION = as.double(COMPUTED_ROUNDED_DURATION))

# Pretvaram NA u brojeve s kojima mogu raditi analizu
teldata <- mutate(teldata, COMPUTED_PRICE_PER_MINUTE = ifelse(is.na(COMPUTED_PRICE_PER_MINUTE), 0, COMPUTED_PRICE_PER_MINUTE))
teldata <- mutate(teldata, COMPUTED_ESTABLISHMENT_FEE = ifelse(is.na(COMPUTED_ESTABLISHMENT_FEE), 0, COMPUTED_ESTABLISHMENT_FEE))
teldata <- mutate(teldata, COMPUTED_ON_PEAK_PRICE_PER_M = ifelse(is.na(COMPUTED_ON_PEAK_PRICE_PER_M), 0, COMPUTED_ON_PEAK_PRICE_PER_M))
teldata <- mutate(teldata, COMPUTED_OFF_PEAK_PRICE_PER_M = ifelse(is.na(COMPUTED_OFF_PEAK_PRICE_PER_M), 0, COMPUTED_OFF_PEAK_PRICE_PER_M))
# teldata <- mutate(teldata, COMPUTED_ROUNDED_DURATION = ifelse(COMPUTED_ROUNDED_DURATION==0, NA, COMPUTED_ROUNDED_DURATION))
teldata <- mutate(teldata, COMPUTED_DESTINATION = ifelse(COMPUTED_DESTINATION=="", NA, COMPUTED_DESTINATION))

# Gledajuci iz perspektive "385-VAS", svaki prazan izvorisni operater je "385-VAS"
teldata <- mutate(teldata, ITEM_ORIGINATING_CARRIER_ID = ifelse(ITEM_ORIGINATING_CARRIER_ID=="", "385-VAS", ITEM_ORIGINATING_CARRIER_ID)) 
```

```{r include=FALSE}
 head(teldata)
 teldata
```

*** SCREENSHOT PODATAKA IZ EXCELA ILI OPIS ATRIBUTA NA RASPOLAGANJU ***


## Provjere ispravnosti podataka

* Želim provjeriti da su podaci kako ih očekujem da budu

### Jesu li svi podaci vezani za poziv(voice)?
```{r}
mutate(teldata, jeVoice = PARAMETER_SERVICE_GROUP == "voice") %>% select(jeVoice) %>% unlist %>% mean
```

##### Opažanja 
* Svi su voice

### U kojem vremenskom razdoblju su podaci očitani?

```{r}
min(teldata$TRANS_DATE)
max(teldata$TRANS_DATE)
```

#### Opažanja 
* Svi podaci su očitani u prvom mjesecu 2017.

#### Zaključak
Podaci su ispravni.

# Univarijantna analiza

## Vrijeme razgovora

```{r}
gunivrijeme <- ggplot(teldata, aes(TRANS_DATE)) + geom_density( fill="#f4b342", alpha=3/4) + ylab("Udio poziva") + xlab("Vrijeme uspostave") + ylab("Postotak zastupljenosti")
gunivrijeme
ggsave("gunivrijeme.png",gunivrijeme)

mean(teldata$PARAMETER_SERVICE_GROUP == "voice")
```


```{r}
summary(teldata$TRANS_DATE)
mean(is.na(teldata$TRANS_DATE))
length(unique(teldata$TRANS_DATE))
```

## Duljina razgovora

```{r}
guniduljina <- ggplot(teldata, aes(ITEM_CALL_DURATION)) + geom_density( fill="#f4b342", alpha = 3/4) + xlim(0,3600) + xlab("Duljina razgovora") + ylab("Postotak zastupljenosti")
guniduljina
ggsave("guniduljina.png",guniduljina)
```


```{r}
summary(teldata$ITEM_CALL_DURATION) # IQR = 251
mean(is.na(teldata$ITEM_CALL_DURATION))
length(unique(teldata$ITEM_CALL_DURATION))
```

```{r}
x <- filter(teldata, ITEM_CALL_DURATION<=3600)
ggplot(teldata, aes(x = ITEM_CALL_DURATION)) + geom_histogram(bins = 20,color = "black",fill="#f4b342") + xlab("Duljina razgovora (sek)") + ylab("Broj poziva")
```

```{r}
teldata <- teldata %>% filter(ITEM_CALL_DURATION <= 3600)
```


## Cijena razgovora

```{r}
summary(teldata$AMOUNT)
mean(is.na(teldata$AMOUNT))
length(unique(teldata$AMOUNT))
```

```{r warning=FALSE}
x <- filter(teldata, ITEM_CALL_DURATION <= 7200)
ggplot(teldata, aes(x = AMOUNT)) + geom_histogram(bins = 30,color = "black",fill="#f4b342") + xlab("Cijena poziva (HRK)") + ylab("Broj poziva")

gunicijena <- ggplot(teldata, aes(AMOUNT)) + geom_density( fill="#f4b342", alpha = 3/4) + xlim(0,1) + xlab("Ukupna cijena poziva (HRK)") + ylab("Postotak zastupljenosti")
ggsave("gunicijena.png",gunicijena)
```

## Odredište poziva

```{r}
summary(teldata$COMPUTED_DESTINATION)
mean(is.na(teldata$COMPUTED_DESTINATION))
length(unique(teldata$COMPUTED_DESTINATION))
```

## Dolaznost poziva

```{r}
summary(teldata$ITEM_CALL_DIRECTION)
mean(is.na(teldata$ITEM_CALL_DIRECTION))
mean(teldata$ITEM_CALL_DIRECTION)
length(unique(teldata$AMOUNT))
```








## Početni pogledi

Općenite karakteristike podataka koje mi omogućuju da dobijem bolji uvid u podatke i ideju za potencijalne zanimljive relacije

### Koliko imam razlicitih klijenata?


```{r}
select(teldata, DEBTOR_ID_MASK) %>% unique %>% nrow # 6775
```

##### Opažanja 
* Podatkovni skup sadrži podatke o navikama 6775 klijenata


### Koliko poziva ima naknadu za uspostavljanje


```{r}
select(teldata, COMPUTED_ESTABLISHMENT_FEE) %>% unlist  %>% mean
```

##### Opažanja 
* 41% poziva nema naknadu za uspostavu

### Koliko odlaznih poziva ima naknadu za uspostavu


```{r}
filter(teldata, ITEM_CALL_DIRECTION == 1 ) %>% transmute(Naplacena_naknada = COMPUTED_ESTABLISHMENT_FEE!=0) %>% unlist %>% mean
```

##### Opažanja 
* 90.8% odlaznih poziva naplaćuje naknadu za uspostavu 

### Koliko iznosi prosječna naknada uspostave odlaznih poziva


```{r}
# ODLAZNI
filter(teldata, ITEM_CALL_DIRECTION == 1) %>% select(COMPUTED_ESTABLISHMENT_FEE) %>% unlist %>% mean
```

##### Opažanja 
* Prosječna naknada za uspostavu odlaznih poziva je 6.75 lipa

### Koliko iznosi prosječna naknada uspostave dolaznih poziva


```{r}
# DOLAZNI
filter(teldata, ITEM_CALL_DIRECTION == 0) %>% select(COMPUTED_ESTABLISHMENT_FEE) %>% unlist %>% mean
```

##### Opažanja 
* Prosječna naknada za uspostavu dolaznih poziva je 0.2 lipe


### Koja taksi služba je najviše zaradila na uspostavi u prvom mjesecu 2017.?


```{r include=FALSE}
teldataDestEstCost <- group_by(teldata, COMPUTED_DESTINATION) %>% summarise(mean_establishment = mean(COMPUTED_ESTABLISHMENT_FEE), max_establishment = max(COMPUTED_ESTABLISHMENT_FEE), min_establishment = min(COMPUTED_ESTABLISHMENT_FEE), N = n()) %>% arrange(desc(mean_establishment))
```


```{r}
taxiTeldata <- filter(teldataDestEstCost, grepl("taksi", tolower(COMPUTED_DESTINATION), fixed = TRUE))
mutate(taxiTeldata, Income_HRK = mean_establishment * N) %>% select(COMPUTED_DESTINATION , Income_HRK)
```

##### Opažanja 
* Neka općenita taksi sluzba je najviše zaradila (pod pretpostavkom da su podaci uniformno vađeni iz stvarnih)

### Koliko prosječno korisnici plaćaju poziv?


```{r}
mean(teldata$AMOUNT)
```

##### Opažanja 
* U prosjeku je poziv naplaćen 37.59 lipa

### Koliko prosječno plaćaju odlazni pozivi?


```{r}
filter(teldata, ITEM_CALL_DIRECTION == 1) %>% select(AMOUNT) %>% unlist %>% mean
```

##### Opažanja 
* Prosječno je odlazni poziv naplaćen 57.92 lipe

### Koliko prosječno plaćaju dolazni pozivi?


```{r}
filter(teldata, ITEM_CALL_DIRECTION == 0) %>% select(AMOUNT) %>% unlist %>% mean
```

##### Opažanja 
* Prosječno je dolazni poziv naplaćen 10.00 lipa



### S kojom je zemlju uspostavljeno najviše poziva?


```{r}
zemljaPoziva <- teldataDestEstCost %>% filter(COMPUTED_DESTINATION == toupper(COMPUTED_DESTINATION)) %>% group_by(Zemlja = substr(COMPUTED_DESTINATION,0,4)) %>% summarise(Poziva = sum(N)) %>% arrange(desc(Poziva))
head(zemljaPoziva)
```

##### Opažanja 
* Najviše je poziva uspostavljeno s Bosnom, Srbijom i Njemačkom.

### Razdbioba poziva prema Bosni, Srbiji i Njemačkoj kroz mjesec


```{r include=FALSE}
zaradaInozemstvo <- teldata %>% mutate(Zemlja = substr(COMPUTED_DESTINATION,0,4)) %>% filter(Zemlja %in% c("BOSN","SERB","GERM","SLOV")) %>% mutate(Dan = day(TRANS_DATE), Dan_u_tjednu = weekdays(TRANS_DATE), JeRadni = !(Dan_u_tjednu %in% c("Sunday", "Saturday") | Dan == 6 | Dan == 1)) %>% group_by(Dan, JeRadni, Zemlja) %>% summarise(Zarada = sum(AMOUNT))

zaradaBiHMjesec <- teldata %>% filter(substr(COMPUTED_DESTINATION,0,4)=="BOSN") %>% mutate(Dan = day(TRANS_DATE), Dan_u_tjednu = weekdays(TRANS_DATE), JeRadni = !(Dan_u_tjednu %in% c("Sunday", "Saturday") | Dan == 6 | Dan == 1)) %>% group_by(Dan, JeRadni) %>% summarise(Zarada = sum(AMOUNT))
zaradaSrbijaMjesec <- teldata %>% filter(substr(COMPUTED_DESTINATION,0,4)=="SERB") %>% mutate(Dan = day(TRANS_DATE), Dan_u_tjednu = weekdays(TRANS_DATE), JeRadni = !(Dan_u_tjednu %in% c("Sunday", "Saturday") | Dan == 6 | Dan == 1)) %>% group_by(Dan, JeRadni) %>% summarise(Zarada = sum(AMOUNT))
zaradaNjemMjesec <- teldata %>% filter(substr(COMPUTED_DESTINATION,0,4)=="GERM") %>% mutate(Dan = day(TRANS_DATE), Dan_u_tjednu = weekdays(TRANS_DATE), JeRadni = !(Dan_u_tjednu %in% c("Sunday", "Saturday") | Dan == 6 | Dan == 1)) %>% group_by(Dan, JeRadni) %>% summarise(Zarada = sum(AMOUNT))

gBiH <- ggplot(zaradaBiHMjesec, aes(x=Dan, y=Zarada)) + geom_point(size=2) + xlab("")+ ggtitle("BiH")+ theme(plot.title = element_text(hjust = 0.5))
gSerb <- ggplot(zaradaSrbijaMjesec, aes(x=Dan, y=Zarada)) + geom_point(size=2) + xlab("") + ggtitle("Srbija")+ theme(plot.title = element_text(hjust = 0.5))
gGerm <- ggplot(zaradaNjemMjesec, aes(x=Dan, y=Zarada)) + geom_point(size=2) + ggtitle("Njemacka")+ theme(plot.title = element_text(hjust = 0.5))
```

```{r}
grid.arrange(gBiH, gSerb, gGerm, ncol=1, nrow=3)
```

```{r}


gridinozemstvo <- ggplot(zaradaInozemstvo, aes(Dan, Zarada)) +
  geom_point() +
  facet_wrap(~ Zemlja)
gridinozemstvo
```
```{r}
ggsave("gridinozemstvo.png",gridinozemstvo)
```


##### Opažanja
* Prema svim zemljama uočavam skok za Novu Godinu. 
* Prema Srbiji i BiH uočavam skok za pravoslavni Božić. 

### Koliki udio zarade čine pozivi prema Srbiji i BiH na pravoslavni Božić?


```{r message=FALSE}
zaradaBalkanMjesec <- teldata %>% mutate(PremaBalkanu = substr(COMPUTED_DESTINATION,0,4)=="BOSN" | substr(COMPUTED_DESTINATION,0,4)=="SERB") %>% mutate(PremaBalkanu = ifelse(is.na(PremaBalkanu), FALSE, PremaBalkanu), Dan = day(TRANS_DATE), Dan_u_tjednu = weekdays(TRANS_DATE), JeRadni = !(Dan_u_tjednu %in% c("Sunday", "Saturday") | Dan == 6 | Dan == 1)) %>% group_by(Dan, PremaBalkanu)%>% summarise(Zarada = sum(AMOUNT))

opcenitaZaradaPoDanu <- zaradaBalkanMjesec %>% group_by(Dan) %>% summarise(ZaradaUk = sum(Zarada) )
zaradaBalkanMjesec <- merge(zaradaBalkanMjesec, opcenitaZaradaPoDanu, id="Dan") %>% filter(PremaBalkanu) %>% mutate(ZaradaUdio = Zarada/ZaradaUk)
zaradaBalkanMjesec <- zaradaBalkanMjesec %>% mutate(VrstaDana = if_else(Dan==1, "Nova Godina", if_else(Dan==7, "Pravoslavni Božić", "Običan dan")))
ggplot(zaradaBalkanMjesec, aes(x=Dan, y=ZaradaUdio, fill=VrstaDana)) + stat_summary(geom="bar", color="Black")
```

##### Opažanja 
* Više od trećine ukupne zarade na pravoslavni Božić proizlazi od poziva upućenih prema BiH ili Srbiji.
* Veliki skokovi u zaradi se događaju na blagdane Novu Godinu i pravoslavni Božić
* Naslućujem da će mi u daljnjoj analizi blagdani predstavljati anomalije u podacima

## Testirane relacije

Zašto sam imao potrebu odvojiti predstojeću analizu u posebno poglavlje? 

* Ovdje već mogu naslutiti da će mi blagdani predstavljati potencijalne probleme/anomalije u analizi
* Želim uočiti okvirne relacije i čvrte matematičke relacije u podacima
* Fokus stavljam na bitne varijable (Dan poziva, Sat poziva, Radnost dana, Je li blagdan, Broj poziva, Duljina poziva, Zarada od poziva) zato što su ostale potencijalno zanimljive varijable maskirane zbog zaštite podataka pa mi rezultati vezani uz takve podatke ne ispadaju zanimljivi.

### Broj Poziva ~ Sat u danu


```{r}
teldataPrometniSati <- group_by(teldata, Sat = hour(TRANS_DATE)) %>% summarise(Poziva = n())
# head(teldataPrometniSati)
gobicansatbroj <- ggplot(teldataPrometniSati, aes(x=Sat, y = Poziva)) + geom_point(size=4)  # + stat_smooth( method="loess", se = FALSE)
gobicansatbroj
```

```{r include=FALSE}
ggsave(file="satbrojobican.png", gobicansatbroj)
```


##### Opažanja 
* Najviše poziva u danu se uspostavlja oko 10h

### Broj Poziva ~ Sat u danu + Radnost dana

Je li gore uočena relacija ista za radne i neradne dane?


```{r}
dataSatDanRadni <- group_by(teldata, Dan = day(TRANS_DATE), Dan_u_tjednu = weekdays(TRANS_DATE), Sat = hour(TRANS_DATE)) %>% summarise(Poziva = n()) %>% mutate(JeNeradniDan = Dan_u_tjednu %in% c("Sunday", "Saturday") || Dan == 6 , JeRadni = !JeNeradniDan)  %>% filter(Dan != 1) 

dataSatRadni <- dataSatDanRadni %>% group_by(Sat, JeRadni) %>% summarise(Prosjecno_poziva = mean(Poziva))

satbrojobojan <- ggplot(dataSatRadni, aes(x=Sat, y=Prosjecno_poziva, color = JeRadni)) + geom_point(size=4) #+ stat_smooth(method = "loess" , se = FALSE)
satbrojobojan
```

```{r include=FALSE}
ggsave(file="satbrojobojan.png", satbrojobojan)
```
##### Opažanja
* I radni i neradni dani prate isti uzorak s dva lokalna maksimuma - u 10h i 17h.
* Krivulja ne ovisi o radnim navikama ljudi.
* Naslućujemo da su radni dani prometniji od neradnih.

### Broj Poziva ~ Sat u danu + Dan u tjednu

Je li gore uočena relacija ista za sve dane u tjednu?


```{r include=FALSE}
dataSatDan <- dataSatDanRadni %>% group_by(Sat, Dan_u_tjednu) %>% summarise(Prosjecno_poziva = mean(Poziva))

dataSatDan$Dan_u_tjednu <- factor(dataSatDan$Dan_u_tjednu, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")) 


dataSatDanPon <- dataSatDan %>% filter(Dan_u_tjednu == "Monday")
dataSatDanUto <- dataSatDan %>% filter(Dan_u_tjednu == "Tuesday")
dataSatDanSri <- dataSatDan %>% filter(Dan_u_tjednu == "Wednesday")
dataSatDanCet <- dataSatDan %>% filter(Dan_u_tjednu == "Thursday")
dataSatDanFri <- dataSatDan %>% filter(Dan_u_tjednu == "Friday")
dataSatDanSat <- dataSatDan %>% filter(Dan_u_tjednu == "Saturday")
dataSatDanSun <- dataSatDan %>% filter(Dan_u_tjednu == "Sunday")

gPon <- ggplot(dataSatDanPon, aes(x=Sat, y=Prosjecno_poziva)) + geom_point(size=1) + xlab("") + ylab("")+ ggtitle("Ponedjeljak") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())# + stat_smooth(method = "loess" , se = FALSE)
gUto <- ggplot(dataSatDanUto, aes(x=Sat, y=Prosjecno_poziva)) + geom_point(size=1) + xlab("") + ylab("")+ ggtitle("Utorak") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())# + stat_smooth(method = "loess" , se = FALSE)
gSri <- ggplot(dataSatDanSri, aes(x=Sat, y=Prosjecno_poziva)) + geom_point(size=1) + xlab("") + ylab("")+ ggtitle("Srijeda") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())# + stat_smooth(method = "loess" , se = FALSE)
gCet <- ggplot(dataSatDanCet, aes(x=Sat, y=Prosjecno_poziva)) + geom_point(size=1) + xlab("") + ylab("")+ ggtitle("Cetvrtak") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())# + stat_smooth(method = "loess" , se = FALSE)
gPet <- ggplot(dataSatDanFri, aes(x=Sat, y=Prosjecno_poziva)) + geom_point(size=1) + xlab("") + ylab("")+ ggtitle("Petak") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())# + stat_smooth(method = "loess" , se = FALSE)
gSub <- ggplot(dataSatDanSat, aes(x=Sat, y=Prosjecno_poziva)) + geom_point(size=1) + xlab("") + ylab("")+ ggtitle("Subota") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())# + stat_smooth(method = "loess" , se = FALSE)
gNed <- ggplot(dataSatDanSun, aes(x=Sat, y=Prosjecno_poziva)) + geom_point(size=1) + xlab("") + ylab("")+ ggtitle("Nedjelja") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())# + stat_smooth(method = "loess" , se = FALSE)

```



```{r}
# grid.arrange(gPon, gUto,gSri,gCet,gPet,gSub,gNed , ncol=2, nrow = 4)
```

```{r}
tjedansatgrid <- ggplot(dataSatDan, aes(Sat, Prosjecno_poziva)) +
  geom_point() +
  facet_wrap(~ Dan_u_tjednu)
tjedansatgrid
```

```{r}
ggsave("tjedansatgrid.png", tjedansatgrid)
```


##### Opažanja
* Krivulja s dva maksimuma se dobiva neovisno o danu u tjednu.

##### Zaključak
Razdioba broja poziva kroz dan je ista za svaki dan u tjednu što znači da takva razdioba ne ovisi o radnim navikama ljudi nego o nekoj drugoj ljudskoj sklonosti.

### Broj Poziva ~ Dan u mjesecu 


```{r}
teldataPrometniDani <- group_by(teldata, Dan = day(TRANS_DATE)) %>% summarise(Poziva = n())
# head(teldataPrometniDani)
obicandanbroj <- ggplot(teldataPrometniDani, aes(x=Dan, y = Poziva)) + geom_point(size=4)
obicandanbroj
```

```{r include=FALSE}
ggsave("obicandanbroj.png",obicandanbroj)
```

##### Opažanja
* Najviše poziva se upućuje za Novu godinu. 
* Naslućujem da se puno više poziva upućuje za radne dane.

* Uočavam da mi blagdani predstavljaju anomalije za analizu. 

* (1.1) Nova godina - neradni dan koji se masovno čestita kako unutar tako i izvan zemlje
* (6.1) Sveta tri kralja - neradni dan koji se ne čestita i zato je promet u njemu sličniji suboti nego petku
* (7.1) Pravoslavni Božić - iako radni dan u Hrvatskoj, promet prema Srbiji i Bosni je višestruko veći i zato više odgovara radnom danu nego običnoj suboti.

##### Zaključak
Blagdani koji se čestitaju (Nova godina i pravoslavni Božić) imaju povećani promet. 
Trebam ukloniti navedene blagdane kako bih mogao bolje testirati relaciju prometa o danu u tjednu.

### Broj Poziva ~ Dan u mjesecu + radnost

```{r}
# Sveta tri kralja su neradna
#teldataPrometniDaniUTjednu <- group_by(teldata, Dan = day(TRANS_DATE), Dan_u_tjednu = weekdays(TRANS_DATE)) %>% summarise(Poziva = n()) %>% mutate(JeNeradniDan = Dan_u_tjednu %in% c("Sunday", "Saturday") || Dan == 6 )  %>% filter(Dan!=1 & Dan!=6 & Dan != 7)
#teldataPrometniDaniUTjednu
#ggplot(teldataPrometniDaniUTjednu , aes(x=Dan, y = Poziva, color=JeNeradniDan)) + geom_point() + stat_smooth( method="lm", aes(group = JeNeradniDan), se = FALSE)


teldataPrometniDaniUTjednu <- group_by(teldata, Dan = day(TRANS_DATE), Dan_u_tjednu = weekdays(TRANS_DATE)) %>% summarise(Poziva = n()) %>% mutate(JeNeradniDan = Dan_u_tjednu %in% c("Sunday", "Saturday") || Dan == 6 )  %>% filter(Dan!=1 & Dan!=6 & Dan != 7)
teldataPrometniDaniUTjednu <- teldataPrometniDaniUTjednu %>% mutate(KategorijaDana = if_else(JeNeradniDan, if_else(Dan_u_tjednu == "Sunday", "Nedjelja", "Subota") , "Radni"))
# teldataPrometniDaniUTjednu
gBrojPozivaRadnost <- ggplot(teldataPrometniDaniUTjednu, aes(x=Dan, y=Poziva, color = KategorijaDana)) + geom_point()+ stat_smooth(method="lm", se = FALSE)
gBrojPozivaRadnost
```

```{r include=FALSE}
ggsave("gBrojPozivaRadnost.png",gBrojPozivaRadnost)
```

#### Opažanja
* Radni dani imaju puno veći promet od neradnih dana.
* Zanimljivi je trend laganog smanjenja broja poziva kroz mjesec i za radne i za neradne dane.

### Broj Poziva ~ Dan u tjednu


```{r}
teldataPrometniDaniUTjednu <- group_by(teldataPrometniDaniUTjednu, Dan_u_tjednu) %>% mutate(Prosjecno_poziva = mean(Poziva)) 
teldataPrometniDaniUTjednu$Dan_u_tjednu <- factor(teldataPrometniDaniUTjednu$Dan_u_tjednu, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")) 
# teldataPrometniDaniUTjednu
gPozivaKrozTj <- ggplot(teldataPrometniDaniUTjednu , aes(Dan_u_tjednu, y = Prosjecno_poziva)) + geom_point(size=4) #  + stat_smooth( method="lm", se = FALSE)
gPozivaKrozTj
```

```{r include=FALSE}
ggsave("gPozivaKrozTj.png",gPozivaKrozTj)
```

#### Opažanja 
* Broj poziva pada kako tjedan odmiče i vikend se bliži.


```{r include = FALSE}
# Ljepši graf onaj gore za slučaj da će treba
gPozivaKrozTjKrivulja <- ggplot(teldataPrometniDaniUTjednu , aes(x=as.numeric(Dan_u_tjednu), y = Prosjecno_poziva)) + geom_point(size=3) + geom_smooth( method="loess", se = FALSE) + xlab("") + ylab("") + ggtitle("Frekvencija poziva kroz tjedan") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())
gPozivaKrozTjLinija <- ggplot(teldataPrometniDaniUTjednu , aes(x=as.numeric(Dan_u_tjednu), y = Prosjecno_poziva)) + geom_point(size=3) + geom_smooth( method="lm", se = FALSE)+ xlab("Dan u tjednu")+ xlab("") + ylab("") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())

brojtjedanlijepo <- ggplot(teldataPrometniDaniUTjednu %>% select(Dan_u_tjednu, Prosjecno_poziva) %>% unique , aes(x=Dan_u_tjednu, y = Prosjecno_poziva)) + geom_bar(stat="identity", color="Black", fill="#f4b342") + xlab("Dan u tjednu") + ylab("Prosječan broj poziva") # + ggtitle("Prosječan broj poziva kroz tjedan")  + theme(plot.title = element_text(hjust = 0.5))
brojtjedanlijepo
```

```{r}
ggsave("brojtjedanlijepo.png",brojtjedanlijepo)
```


### Broj poziva ~ Dan u tjednu + operater

Zanima me je li relacija univerzalna za svakog operatera a pritom uzimam izvorišnog operatera.


```{r include= FALSE}
teldataPrometniDaniUTjednuOperateri <- teldata %>% filter(!day(TRANS_DATE)%in% c(1,6,7)) %>% mutate(Dan_u_tjednu = weekdays(TRANS_DATE)) %>%  group_by(Dan_u_tjednu, ITEM_ORIGINATING_CARRIER_ID) %>% summarise(Prosjecno_poziva = mean(n()))
teldataPrometniDaniUTjednuOperateri$Dan_u_tjednu <- factor(teldataPrometniDaniUTjednuOperateri$Dan_u_tjednu, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")) 
# teldataPrometniDaniUTjednuOperateri

danUTjednuH1 <- teldataPrometniDaniUTjednuOperateri %>% filter(ITEM_ORIGINATING_CARRIER_ID == "385-H1")
danUTjednuHT <- teldataPrometniDaniUTjednuOperateri %>% filter(ITEM_ORIGINATING_CARRIER_ID == "385-HT-CPS")
danUTjednuIskon <- teldataPrometniDaniUTjednuOperateri %>% filter(ITEM_ORIGINATING_CARRIER_ID == "385-ISKON")
danUTjednuMetronet <- teldataPrometniDaniUTjednuOperateri %>% filter(ITEM_ORIGINATING_CARRIER_ID == "385-METRONET")
danUTjednuSoftX <- teldataPrometniDaniUTjednuOperateri %>% filter(ITEM_ORIGINATING_CARRIER_ID == "385-SOFTX")
danUTjednuTCOM <- teldataPrometniDaniUTjednuOperateri %>% filter(ITEM_ORIGINATING_CARRIER_ID == "385-TCOM")
danUTjednuTele2 <- teldataPrometniDaniUTjednuOperateri %>% filter(ITEM_ORIGINATING_CARRIER_ID == "385-TELE2")
danUTjednuVAS <- teldataPrometniDaniUTjednuOperateri %>% filter(ITEM_ORIGINATING_CARRIER_ID == "385-VAS")
danUTjednuVIPNET <- teldataPrometniDaniUTjednuOperateri %>% filter(ITEM_ORIGINATING_CARRIER_ID == "385-VIPNET")

gH1 <- ggplot(danUTjednuH1 , aes(x=as.numeric(Dan_u_tjednu), y = Prosjecno_poziva)) + geom_point(size=3) + stat_smooth(method="lm", se=FALSE) + xlab("") + ylab("")+ ggtitle("H1") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())
gHT <- ggplot(danUTjednuHT , aes(x=as.numeric(Dan_u_tjednu), y = Prosjecno_poziva)) + geom_point(size=3)+ stat_smooth(method="lm", se=FALSE) + xlab("") + ylab("")+ ggtitle("HT") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())
gIskon <- ggplot(danUTjednuIskon , aes(x=as.numeric(Dan_u_tjednu), y = Prosjecno_poziva)) + geom_point(size=3)+ stat_smooth(method="lm", se=FALSE)  + xlab("") + ylab("")+ ggtitle("Iskon") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())
gMetronet <- ggplot(danUTjednuMetronet , aes(x=as.numeric(Dan_u_tjednu), y = Prosjecno_poziva)) + geom_point(size=3) + stat_smooth(method="lm", se=FALSE) + xlab("") + ylab("")+ ggtitle("Metronet") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())
gSoftX <- ggplot(danUTjednuSoftX , aes(x=as.numeric(Dan_u_tjednu), y = Prosjecno_poziva)) + geom_point(size=3) + stat_smooth(method="lm", se=FALSE) + xlab("") + ylab("")+ ggtitle("SoftX") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())
gTCOM <- ggplot(danUTjednuTCOM , aes(x=as.numeric(Dan_u_tjednu), y = Prosjecno_poziva)) + geom_point(size=3) + stat_smooth(method="lm", se=FALSE) + xlab("") + ylab("")+ ggtitle("TCOM") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())
gTele2 <- ggplot(danUTjednuTele2 , aes(x=as.numeric(Dan_u_tjednu), y = Prosjecno_poziva)) + geom_point(size=3) + stat_smooth(method="lm", se=FALSE) + xlab("") + ylab("")+ ggtitle("Tele2") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())
gVAS <- ggplot(danUTjednuVAS , aes(x=as.numeric(Dan_u_tjednu), y = Prosjecno_poziva)) + stat_smooth(method="lm", se=FALSE) + geom_point(size=3) + xlab("") + ylab("")+ ggtitle("VAS") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())
gVIPNET <- ggplot(danUTjednuVIPNET , aes(x=as.numeric(Dan_u_tjednu), y = Prosjecno_poziva)) + geom_point(size=3)+ stat_smooth(method="lm", se=FALSE)  + xlab("") + ylab("")+ ggtitle("VIPNET") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())
```



```{r}
grid.arrange(gH1, gHT, gIskon, gMetronet, gSoftX, gTCOM, gTele2, gVAS,gVIPNET, ncol = 3, nrow = 3)
```

```{r}
#ggplot(teldataPrometniDaniUTjednuOperateri, aes(Dan_u_tjednu, Prosjecno_poziva)) +
#  geom_point() +
#  facet_wrap(~ ITEM_ORIGINATING_CARRIER_ID)
```


```{r include=FALSE}
g <- arrangeGrob(gH1, gHT, gIskon, gMetronet, gSoftX, gTCOM, gTele2, gVAS,gVIPNET, ncol = 3, nrow = 3)
ggsave(file="grid.png", g)
```

##### Opažanja 
* Jednak je uzorak kroz tjedan za svakog od izvorišnih operatera.
* Možemo razmišljati o linearnom modelu


#### Razvoj linearnog modela relacije

Iz prijašnjih grafova mogu naslutiti da količina poziva u danu ovisi o danu u tjednu i izvorišnom operateru. Npr. ako znam da je utorak i nije blagdan onda mogu naslutiti da ću dobiti toliko i toliko poziva od VIPNET-a.


```{r}
OperateriKrozTjedan <- teldata  %>% mutate(Dan_u_tjednu = weekdays(TRANS_DATE), Dan = day(TRANS_DATE))%>% filter(Dan!=1 & Dan != 6 & Dan != 7) %>% group_by(Dan, Dan_u_tjednu, ITEM_ORIGINATING_CARRIER_ID) %>% summarise(Poziva = n())
OperateriKrozTjedan$Dan_u_tjednu <- factor(OperateriKrozTjedan$Dan_u_tjednu, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")) 
OperateriKrozTjedan

linmodPrometTjedan <- lm(Poziva ~ as.numeric(Dan_u_tjednu) + ITEM_ORIGINATING_CARRIER_ID, data=OperateriKrozTjedan)

summary(linmodPrometTjedan)
```

##### Opažanja
* Linearni model daje izvrsne rezultate (R-squared = 0.9736) čime se da naslutiti da je dan u tjednu i proizvoljni operater dovoljno dobar pokazatelj za broj uspostavljenih poziva 

#### Razvoj linearnog modela na većem podatkovnom skupu


```{r}
# TODO 24 mil. 
```

##### Opažanja
*

##### Zaključak
Obzirom da je broj poziva općenito pada kroz radni tjedan, mogu zaključiti da što je dan radniji to je više uspustavljenih poziva. 
Uzmemo li u obzir da se ne radi o blagdanu, možemo vrlo precizno predvidjeti koliko će poziva biti upućeno od strane pojedinog operatera na temelju znanja o danu u tjednu.



```{r include = FALSE}
duljinaPozivaVrijeme <- teldata %>% mutate(Dan=day(TRANS_DATE), Dan_u_tjednu = weekdays(TRANS_DATE), JeRadni = !(Dan_u_tjednu %in% c("Sunday", "Saturday") | Dan == 6)) %>% group_by(Dan, Dan_u_tjednu, JeRadni) %>% summarise(Prosjecno_trajanje_poziva = mean(ITEM_CALL_DURATION))
# head(duljinaPozivaVrijeme)
```

### Duljina razgovora ~ Satu u danu

```{r}
DuljinaRazgovoraSatOpcenito <- teldata %>% mutate(Sat = hour(TRANS_DATE), Dan_u_tjednu = weekdays(TRANS_DATE), Dan=day(TRANS_DATE)) %>% group_by(Sat) %>% summarise(ProsjecnaDuljinaRazgovora = mean(ITEM_CALL_DURATION))
gDuljinaOpcenito <- ggplot(DuljinaRazgovoraSatOpcenito, aes(x=Sat, y=ProsjecnaDuljinaRazgovora)) + geom_point(size=4)
gDuljinaOpcenito
```

```{r include=FALSE}
ggsave("gDuljinaOpcenito.png",gDuljinaOpcenito)
```

##### Opažanja
* Ljudi najviše vole pričati u 21h navečer.

### Duljina razgovora ~ Sat u danu + Blagdan

```{r include =FALSE}
#DuljinaRazgovoraSatObican <- teldata %>% mutate(Sat = hour(TRANS_DATE), Dan_u_tjednu = weekdays(TRANS_DATE), Dan=day(TRANS_DATE))%>% filter(!Dan %in% c(1,6,7))  %>% group_by(Sat) %>% summarise(ProsjecnaDuljinaRazgovora = mean(ITEM_CALL_DURATION))

DuljinaRazgovoraSatObican <- teldata %>% mutate(Sat = hour(TRANS_DATE), Dan_u_tjednu = weekdays(TRANS_DATE), Dan=day(TRANS_DATE), Kategorija = if_else(Dan ==1 , "Nova godina", if_else(Dan == 6, "Sveta tri kralja", if_else(Dan == 7, "Pravoslavni Božić", "Običan dan")))) %>% group_by(Sat, Kategorija) %>% summarise(ProsjecnaDuljinaRazgovora = mean(ITEM_CALL_DURATION))



#DuljinaRazgovoraSatNG <- teldata %>% mutate(Sat = hour(TRANS_DATE), Dan_u_tjednu = weekdays(TRANS_DATE), Dan=day(TRANS_DATE)) %>% filter(Dan == 1) %>% group_by(Sat) %>% summarise(ProsjecnaDuljinaRazgovora = mean(ITEM_CALL_DURATION))
#DuljinaRazgovoraSatPB <- teldata %>% mutate(Sat = hour(TRANS_DATE), Dan_u_tjednu = weekdays(TRANS_DATE), Dan=day(TRANS_DATE)) %>% filter(Dan == 7) %>% group_by(Sat) %>% summarise(ProsjecnaDuljinaRazgovora = mean(ITEM_CALL_DURATION))
#DuljinaRazgovoraSatSTK <- teldata %>% mutate(Sat = hour(TRANS_DATE), Dan_u_tjednu = weekdays(TRANS_DATE), Dan=day(TRANS_DATE)) %>% filter(Dan == 6) %>% group_by(Sat) %>% summarise(ProsjecnaDuljinaRazgovora = mean(ITEM_CALL_DURATION))

#gDuljinaObican <-  ggplot(DuljinaRazgovoraSatObican, aes(x=Sat, y=ProsjecnaDuljinaRazgovora)) + geom_point(size=1) + xlab("") + ylab("")+ ggtitle("Obican dan") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())
#gDuljinaNG <- ggplot(DuljinaRazgovoraSatNG, aes(x=Sat, y=ProsjecnaDuljinaRazgovora)) + geom_point(size=1)+ xlab("") + ylab("")+ ggtitle("Nova godina") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())
#gDuljinaPB <- ggplot(DuljinaRazgovoraSatPB, aes(x=Sat, y=ProsjecnaDuljinaRazgovora)) + geom_point(size=1)+ xlab("") + ylab("")+ ggtitle("Pravoslavni Bozic") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())
#gDuljinaSTK <- ggplot(DuljinaRazgovoraSatSTK, aes(x=Sat, y=ProsjecnaDuljinaRazgovora)) + geom_point(size=1)+ xlab("") + ylab("")+ ggtitle("Sveta tri kralja") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())

```


```{r}
# grid.arrange(gDuljinaObican,gDuljinaNG,gDuljinaPB,gDuljinaSTK, ncol=2, nrow=2)
```

```{r}
gridblagdanduljina <- ggplot(DuljinaRazgovoraSatObican, aes(Sat, ProsjecnaDuljinaRazgovora)) +
  geom_point() +
  facet_wrap(~ Kategorija)
gridblagdanduljina
```

```{r include=FALSE}
ggsave("gridblagdanduljina.png",gridblagdanduljina)
```

#### Opažanja
* Svi blagdani prate rastući trend duljine poziva osim Sveta tri kralja. Za taj blagdan su duljine ujednačenije i dolazi do velike anomalije u 1 ujutro prouzročene jednim pozivom koji je trajao 6398 sekundi.

```{r include = FALSE}
# KOLIKO UOPCE IMAM tih poziva na STK u 1 u noci
 teldata %>% mutate(Sat = hour(TRANS_DATE),  Dan=day(TRANS_DATE))%>% filter(Dan == 6 & Sat ==1) %>% arrange(desc(ITEM_CALL_DURATION))
```

### Duljina poziva ~ Sat u danu + Danu u tjednu


```{r include=FALSE}
DuljinaRazgovoraSat <- teldata %>% mutate(Sat = hour(TRANS_DATE), Dan_u_tjednu = weekdays(TRANS_DATE), Dan=day(TRANS_DATE)) %>% group_by(Sat, Dan_u_tjednu) %>% summarise(ProsjecnaDuljinaRazgovora = mean(ITEM_CALL_DURATION))

DuljinaRazgovoraSat$Dan_u_tjednu <- factor(DuljinaRazgovoraSat$Dan_u_tjednu, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")) 


#duljinaRazgovoraSatPon <- DuljinaRazgovoraSat %>% filter(Dan_u_tjednu == "Monday")
#duljinaRazgovoraSatUto <- DuljinaRazgovoraSat %>% filter(Dan_u_tjednu == "Tuesday")
#duljinaRazgovoraSatSri <- DuljinaRazgovoraSat %>% filter(Dan_u_tjednu == "Wednesday")
#duljinaRazgovoraSatCet <- DuljinaRazgovoraSat %>% filter(Dan_u_tjednu == "Thursday")
#duljinaRazgovoraSatPet <- DuljinaRazgovoraSat %>% filter(Dan_u_tjednu == "Friday")
#duljinaRazgovoraSatSub <- DuljinaRazgovoraSat %>% filter(Dan_u_tjednu == "Saturday")
#duljinaRazgovoraSatNed <- DuljinaRazgovoraSat %>% filter(Dan_u_tjednu == "Sunday")

#gPon <- ggplot(duljinaRazgovoraSatPon, aes(x=Sat, y=ProsjecnaDuljinaRazgovora)) + geom_point(size=1) + xlab("") + ylab("")+ ggtitle("Ponedjeljak") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())
#gUto <- ggplot(duljinaRazgovoraSatUto, aes(x=Sat, y=ProsjecnaDuljinaRazgovora)) + geom_point(size=1) + xlab("") + ylab("")+ ggtitle("Utorak") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())
#gSri <- ggplot(duljinaRazgovoraSatSri, aes(x=Sat, y=ProsjecnaDuljinaRazgovora)) + geom_point(size=1) + xlab("") + ylab("")+ ggtitle("Srijeda") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())
#gCet <- ggplot(duljinaRazgovoraSatCet, aes(x=Sat, y=ProsjecnaDuljinaRazgovora)) + geom_point(size=1) + xlab("") + ylab("")+ ggtitle("Cetvrtak") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())
#gPet <- ggplot(duljinaRazgovoraSatPet, aes(x=Sat, y=ProsjecnaDuljinaRazgovora)) + geom_point(size=1) + xlab("") + ylab("")+ ggtitle("Petak") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())
#gSub <- ggplot(duljinaRazgovoraSatSub, aes(x=Sat, y=ProsjecnaDuljinaRazgovora)) + geom_point(size=1) + xlab("") + ylab("")+ ggtitle("Subota") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())
#gNed <- ggplot(duljinaRazgovoraSatNed, aes(x=Sat, y=ProsjecnaDuljinaRazgovora)) + geom_point(size=1) + xlab("") + ylab("")+ ggtitle("Nedjelja") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())
```

```{r}
#grid.arrange(gPon, gUto,gSri,gCet,gPet,gSub,gNed, ncol=2, nrow = 4)
```

```{r}
gridduljinasattjedan <- ggplot(DuljinaRazgovoraSat, aes(Sat, ProsjecnaDuljinaRazgovora)) +
  geom_point() +
  facet_wrap(~ Dan_u_tjednu)
gridduljinasattjedan
```


```{r include=FALSE}
ggsave("gridduljinasattjedan.png",gridduljinasattjedan)
```

##### Opažanja
* Svaki od dana kroz tjedan prati trend rasta duljine razgovora s maksimumom u 21h.

##### Zaključak
Prosječna duljina razgovora korisnika je najveća oko 21h navečer i najmanja oko 3h ujutro i ne ovisi o danu u tjednu te o tome radi li se o blagdanu ili ne. 
Čini se da ljudi jednostavno vole razgovarati duže kako dan dolazi kraju.  

### Duljina razgovora ~ Dan u mjesecu


```{r}
ggplot(duljinaPozivaVrijeme, aes(x=Dan, y=Prosjecno_trajanje_poziva)) + geom_point(size=3)
```

##### Opažanja 
* Naslućujem da postoji relacija između trajanja poziva i dana u tjednu i blagdana. 


### Duljina razgovora ~ Dan u mjesecu + Dan u tjednu


```{r}
gdanduljinatjedan <- ggplot(duljinaPozivaVrijeme, aes(x=Dan, y=Prosjecno_trajanje_poziva, color = Dan_u_tjednu)) + geom_point(size=3) #+ stat_smooth(method="lm", se = FALSE)
gdanduljinatjedan
```


```{r include=FALSE}
ggsave("gdanduljinatjedan.png",gdanduljinatjedan)
```

##### Opažanja
* Nedjelja ima konzistentno duže pozive od subote, a subota konzistentno duže pozive od ostalih radnih dana
* Čini se da je za radne dane prilično uniformna razdioba duljine poziva
* Nova godina (1.1.) - Pozivi traju *kraće* nego na ostale nedjelje (anomalija)
* Sveta tri kralja (6.1.) - Pozivi traju primjetno *duže* od ostalih petaka (anomalija)
* Pravoslavni Božić (7.1.) - Pozivi traju jednako kao na ostale subote

##### Zaključak
Bolje ću istražiti ovisnost duljine poziva o vremenu uspostave poziva ako isključim blagdane.


```{r include =FALSE}
duljinaPozivaVrijeme<- duljinaPozivaVrijeme %>% filter(Dan!=1 & Dan!=6)
```


### Duljina razgovora ~ Radnost


```{r}
duljinaPozivaVrijemeRadnost <- duljinaPozivaVrijeme %>% mutate(KategorijaDana = if_else(JeRadni, "Radni", if_else(Dan_u_tjednu == "Sunday", "Nedjelja", "Subota")))
gDuljinaPozivaRadnost <- ggplot(duljinaPozivaVrijemeRadnost, aes(x=Dan, y=Prosjecno_trajanje_poziva, color = KategorijaDana)) + geom_point(size=2)+ stat_smooth(method="lm", se = FALSE)
gDuljinaPozivaRadnost
```


```{r include=FALSE}
ggsave("gDuljinaPozivaRadnost.png",gDuljinaPozivaRadnost)
```

#### Opažanja 
* Ako uklonim blagdane, dobijem mjerodavan prikaz navika korisnika glede duljine poziva u ovisnosti o danu u tjednu. 
* Pozivi su puno kraći kada se radi o radnim danima.
* Nedjelje, kao najneradniji dan, imaju prosječno najdulje pozive
* Duljina poziva nema prepoznatljivu razdiobu kroz radni tjedan.
* Ljudi pričaju općenito dulje kako odmiče prvi mjesec.

### Duljina razgovora ~ dan u tjednu


```{r}
duljinaPozivaKrozTjedan <- teldata %>% mutate(Dan=day(TRANS_DATE), Dan_u_tjednu = weekdays(TRANS_DATE)) %>% filter(Dan!=1 & Dan!=6) %>% group_by(Dan_u_tjednu) %>% summarise(Prosjecno_trajanje_poziva = mean(ITEM_CALL_DURATION))

duljinaPozivaKrozTjedan$Dan_u_tjednu <- factor(duljinaPozivaKrozTjedan$Dan_u_tjednu, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")) 

gDuljinaPozivaKrozTjedan <- ggplot(duljinaPozivaKrozTjedan, aes(x=Dan_u_tjednu, y= Prosjecno_trajanje_poziva)) + geom_point(size=4) 
gDuljinaPozivaKrozTjedan
```


```{r include=FALSE}
ggsave("gDuljinaPozivaKrozTjedan.png",gDuljinaPozivaKrozTjedan)
```

#### Opažanja
* Minimalne su razlike između prosječne duljine poziva kroz radni tjedan

#### Zaključak
Što je dan više radan, to su pozivi kraći. Pretpostavljam da ljudi radnim danima zovu s konkretnom porukom sugovorniku, dok se neradnim danima češće uspostavljaju pozivi kojima je cilj općenito razgovor a ne prijenos informacije.


### Usporedba s prijašnjim zaključkom o frekvenciji poziva


```{r}
# gPozivaKrozTjKrivulja
# gPozivaKrozTj
# gPozivaKrozTjLinija

ggplot(duljinaPozivaKrozTjedan, aes(x=as.numeric(Dan_u_tjednu), y= Prosjecno_trajanje_poziva)) + geom_bar(stat = "identity") + xlab("") +ylab("") + ggtitle("Duljina poziva kroz tjedan") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())


duljinatjedanlijepo <- ggplot(duljinaPozivaKrozTjedan , aes(x=Dan_u_tjednu, y = Prosjecno_trajanje_poziva)) + geom_bar(stat="identity", color="Black", fill="#f4b342") + xlab("Dan u tjednu") + ylab("Prosječna duljina poziva (sek)")#  + ggtitle("Prosječna duljina poziva kroz tjedan")  + theme(plot.title = element_text(hjust = 0.5))
duljinatjedanlijepo

gDuljinaPozivaKrozTjedanPrikaz <- ggplot(duljinaPozivaKrozTjedan, aes(x=as.numeric(Dan_u_tjednu), y= Prosjecno_trajanje_poziva)) + geom_point(size=4) + stat_smooth(method="loess", se=FALSE)+ xlab("") +ylab("") + ggtitle("Duljina poziva kroz tjedan") + theme(plot.title = element_text(hjust = 0.5),axis.text.x=element_blank(),  axis.ticks.x=element_blank())

grid.arrange(gPozivaKrozTjKrivulja, gDuljinaPozivaKrozTjedanPrikaz, ncol = 1, nrow=2)
```

##### Zaključak
Što je dan radniji to su pozivi češći i kraće traju.


### Zarada ~ Dan u mjesecu


```{r message=FALSE}
zaradaDan <- teldata %>% mutate(Dan = day(TRANS_DATE), Dan_u_tjednu = weekdays(TRANS_DATE), JeRadni = !(Dan_u_tjednu %in% c("Sunday", "Saturday")),
                                VrstaDana = ifelse(Dan==1, "Nova Godina", 
                                                   if_else(Dan==6,"Sveta tri kralja", 
                                                           if_else(Dan == 7, "Pravoslavni Bozic", 
                                                                   if_else(JeRadni, "Radni", "Neradni"))))) %>% group_by(Dan, JeRadni, VrstaDana) %>% summarise(Zarada = sum(AMOUNT))

gzarada <- ggplot(zaradaDan, aes(x=Dan, y=Zarada, fill=VrstaDana)) + stat_summary(geom="bar", color="Black")
gzarada
```


```{r include=FALSE}
ggsave("gzarada.png",gzarada)
```

##### Opažanja  
* Nova Godina očekivano donosi najviše zarade iako se radi o nedjelji
* Pravoslavni Božić donosi puno veću zaradu od obične subote
* Sveta tri kralja donese manju zaradu od običnog petka

* Zarada lagano raste kako mjesec odmiče
* Što se dogodađa 17.1??
* Više se uprihodi na radne nego neradne dane
* Najviše se uprihodi na blagdane koji se čestitaju

##### Zaključak
Zarada operatera načelno prati frekvenciju poziva. Blagdani koji se generalno čestitaju (Nova godina i pravoslavni Božić) donose veće prihode od uobičajenih dana, inače radni dani donose više zarade od neradnih.

# Zaključak

* Ponoviti da se radi o podacima poziva u prvom mjesecu iz perspektive samo jednog operatera - to sve može utjecati na rezultate.
* Krenuti od slabiji relacija (više opažanja) i na kraju doći do onih najsnažnijih (matematički utvrđenih) relacija

* SNAŽNA RELACIJA ... Promet je povećan kada se radi o blagdanima koji se čestitaju (Nova godina ili pravoslavni Božić)
* FORA OPAŽANJE ... Za pravoslavni Božić je 1/3 prihoda proizašla od poziva prema BiH i Srbiji
* MALA RELACIJA ... Ljudi razgovaraju sve rijeđe i duže kako odmiče prvi mjesec. 
* SNAŽNA RELACIJA ... Ljudi razgovaraju zamjetno češće kroz radni tjedan nego preko vikenda.
* SNAŽNA RELACIJA ... Duljina poziva je puno veća za neradne dane.
* FORA OPAŽANJE ... Najviše poziva u danu se upućuje oko 10 ujutro i to neovisno o radnosti dana
* FORA OPAŽANJE ... Pozivi su najdulji oko 21h i najkraći oko 3h ujutro, neovisno o blagdanima ili danu u tjednu
* GLAVNA RELACIJA ... Ako se radi o blagdanu koji se čestita onda mogu očekivati povećani promet, inače vrijedi da što je dan radniji to su pozivi češći i kraće traju. Pretpostavljam da je to zato što ljudi točno znaju što žele reći kad su radni dani u pitanju, dok za neradne dane više samo žele razgovarati nego prenijeti neku određenu poruku. 

* BOMBA FORA ... Za Novu godinu su pozivi češći i kraće traju nego za ostale nedjelje... znači li to da je čestitanje Nove godine više posao nego želja?
* DOBRA FORA ... Hrvati imaju najviše rodbinskih/poslovnih veza redom prema BiH, Srbiji i Njemačkog.

# Literatura
....

# Kratki sadržaj na oba jezika s ključnim riječima

##### NEKA MOJA ISPROBAVANJA


